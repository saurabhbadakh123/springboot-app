steps:
# 1. Build Java application
- task: Maven@3
  inputs:
    mavenPomFile: 'springboot-app-main/pom.xml'
    goals: 'package'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
  displayName: 'Build Spring Boot App'

# 2. Prepare Docker build context
- script: |
    echo "Checking for JAR file..."
    ls -la springboot-app-main/target/*.jar
    
    echo "Creating docker directory..."
    mkdir -p springboot-app-main/docker
    
    echo "Copying JAR file..."
    cp springboot-app-main/target/*.jar springboot-app-main/docker/
    
    echo "Verifying copy..."
    ls -la springboot-app-main/docker/
  displayName: 'Prepare Docker Build Context'

# 3. Build and push Docker image
- script: |
    echo "Building image with tag: $(tag)"
    cd springboot-app-main/docker
    docker build -t $(acrLoginServer)/$(imageRepository):$(tag) -f ../Dockerfile .
    docker images
    docker push $(acrLoginServer)/$(imageRepository):$(tag)
  displayName: 'Build and Push Docker Image'
