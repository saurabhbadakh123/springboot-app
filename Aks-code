- task: AzureCLI@2
  displayName: 'Force Rollout'
  inputs:
    azureSubscription: 'service-connection'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Refresh AKS credentials (critical)
      az aks get-credentials \
        --resource-group pythonapp-rg \
        --name pythonapp-aks \
        --overwrite-existing \
        --admin  # Bypasses RBAC issues
      
      # Verify connection
      kubectl cluster-info
      
      # Force rollout
      kubectl rollout restart deployment/python-app -n default
      
      # Monitor with timeout
      kubectl rollout status deployment/python-app -n default --timeout=120s
      
      # Final verification
      kubectl get pods -n default -w
